<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoyalRoi å“¡å·¥æœå‹™ç³»çµ± - å…¨å“¡æ¸¬è©¦ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 100%;
            overflow: hidden;
        }

        .test-mode-banner {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .all-employees-banner {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .login-section, .dashboard-section {
            display: none;
        }

        .login-section.active, .dashboard-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group select, .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .user-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .user-info h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .user-info p {
            margin-bottom: 8px;
            color: #666;
            font-size: 1.1em;
        }

        .user-info .hours {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .user-info .hours span {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .service-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .service-card.direct-submit {
            border-left: 5px solid #28a745;
        }

        .service-card.direct-submit .badge {
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 10px;
        }

        .service-card h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
        }

        .service-card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .service-card .icon {
            font-size: 2em;
            margin-bottom: 15px;
            color: #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 20px 20px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5em;
        }

        .modal-body {
            padding: 30px;
        }

        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.8;
        }

        .close:hover {
            opacity: 1;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: 500;
        }

        .alert.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .deputy-section {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #ffc107;
        }

        .deputy-section h4 {
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .deputy-section .icon {
            margin-right: 10px;
            color: #ffc107;
        }

        .employee-count {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin: 10px 0;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .content {
                padding: 20px;
            }

            .services-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å…¨å“¡æ¸¬è©¦æ¨¡å¼æ©«å¹… -->
        <div class="test-mode-banner">
            ğŸ§ª å…¨å“¡æ¸¬è©¦æ¨¡å¼å•Ÿç”¨ä¸­ - æ‰€æœ‰é€šçŸ¥ç™¼é€çµ¦HRé€²è¡Œå®‰å…¨æ¸¬è©¦
        </div>
        
        <!-- å…¨å“¡æ”¯æ´æ©«å¹… -->
        <div class="all-employees-banner">
            ğŸ‘¥ æ”¯æ´æ‰€æœ‰20ä½å“¡å·¥ - å®Œæ•´åŠŸèƒ½æ¸¬è©¦ç‰ˆæœ¬
        </div>

        <!-- æ¨™é¡Œå€åŸŸ -->
        <div class="header">
            <h1>ğŸ¨ RoyalRoi å“¡å·¥æœå‹™ç³»çµ±</h1>
            <p>å…¨å“¡æ¸¬è©¦ç‰ˆ - ç¾ä»£åŒ–æ•¸ä½æœå‹™å¹³å°</p>
            <div class="employee-count">
                ğŸ“Š æ”¯æ´å“¡å·¥ç¸½æ•¸ï¼š20ä½
            </div>
        </div>

        <!-- å…§å®¹å€åŸŸ -->
        <div class="content">
            <!-- ç™»å…¥å€åŸŸ -->
            <div class="login-section active" id="loginSection">
                <div class="form-group">
                    <label for="loginType">é¸æ“‡ç™»å…¥æ–¹å¼ï¼š</label>
                    <select id="loginType" onchange="toggleLoginType()">
                        <option value="first">é¦–æ¬¡ç™»å…¥ï¼ˆè¨­å®šå¯†ç¢¼ï¼‰</option>
                        <option value="normal">å“¡å·¥ç™»å…¥</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="employeeName">é¸æ“‡æ‚¨çš„å§“åï¼š</label>
                    <select id="employeeName">
                        <option value="">è«‹é¸æ“‡...</option>
                        <option value="å»–è¿°ç››">å»–è¿°ç›› - è‘£äº‹é•·</option>
                        <option value="ç‹å½§ç–†">ç‹å½§ç–† - ç‡Ÿé‹ç¸½ç›£</option>
                        <option value="é™³å®¶èˆˆ">é™³å®¶èˆˆ - ç®¡ç†éƒ¨å‰¯ç†</option>
                        <option value="é»ƒå´‘å¢ƒ">é»ƒå´‘å¢ƒ - å·¥å‹™ä¸»ä»»</option>
                        <option value="å¾å¿—å±¹">å¾å¿—å±¹ - è¡ŒéŠ·æ¥­å‹™ä¸»ä»»</option>
                        <option value="æ±Ÿå­Ÿåº­">æ±Ÿå­Ÿåº­ - å®¢å‹™çµ„é•·</option>
                        <option value="è•­ç¶­å®">è•­ç¶­å® - å®¢å‹™çµ„é•·</option>
                        <option value="å®‹æ·å®‰">å®‹æ·å®‰ - é£¯åº—ç®¡å®¶</option>
                        <option value="é™³ç´…ç§€">é™³ç´…ç§€ - é£¯åº—ç®¡å®¶</option>
                        <option value="æ—å®¶æ¥™">æ—å®¶æ¥™ - é£¯åº—ç®¡å®¶</option>
                        <option value="æ¥Šä¸å‹›">æ¥Šä¸å‹› - é£¯åº—ç®¡å®¶</option>
                        <option value="å¾å¥•ç¿”">å¾å¥•ç¿” - é£¯åº—ç®¡å®¶</option>
                        <option value="æŸ¯å®—ç”·">æŸ¯å®—ç”· - å®¢å‹™çµ„é•·</option>
                        <option value="æç¶­è">æç¶­è - å®¢æˆ¿éƒ¨å‰¯ç†</option>
                        <option value="è¨±é‚¦èˆˆ">è¨±é‚¦èˆˆ - è³‡æ·±æˆ¿å‹™å“¡</option>
                        <option value="ç‹æ–‡ä¸€">ç‹æ–‡ä¸€ - è³‡æ·±æˆ¿å‹™çµ„é•·</option>
                        <option value="ç¾…ç´¹æ–‡">ç¾…ç´¹æ–‡ - è³‡æ·±æˆ¿å‹™å“¡</option>
                        <option value="æ—å¥‡ç·¯">æ—å¥‡ç·¯ - è³‡æ·±æˆ¿å‹™å“¡</option>
                        <option value="æŸ³ä½³ç’‹">æŸ³ä½³ç’‹ - è³‡æ·±æˆ¿å‹™å“¡</option>
                        <option value="HR">HR - äººäº‹</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="employeeId">å“¡å·¥ç·¨è™Ÿï¼š</label>
                    <input type="text" id="employeeId" placeholder="è«‹è¼¸å…¥æ‚¨çš„å“¡å·¥ç·¨è™Ÿ">
                </div>

                <div id="firstLoginFields" style="display: none;">
                    <button class="btn" onclick="verifyIdentity()">é©—è­‰èº«ä»½</button>
                    
                    <div id="passwordSetupFields" style="display: none;">
                        <div class="form-group">
                            <label for="newPassword">è¨­å®šå¯†ç¢¼ï¼š</label>
                            <input type="password" id="newPassword" placeholder="è«‹è¼¸å…¥å¯†ç¢¼ï¼ˆè‡³å°‘6å€‹å­—å…ƒï¼‰">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">ç¢ºèªå¯†ç¢¼ï¼š</label>
                            <input type="password" id="confirmPassword" placeholder="è«‹å†æ¬¡è¼¸å…¥å¯†ç¢¼">
                        </div>
                        <button class="btn success" onclick="setupPassword()">è¨­å®šå¯†ç¢¼</button>
                    </div>
                </div>

                <div id="normalLoginFields">
                    <div class="form-group">
                        <label for="password">å¯†ç¢¼ï¼š</label>
                        <input type="password" id="password" placeholder="è«‹è¼¸å…¥æ‚¨çš„å¯†ç¢¼">
                    </div>
                    <button class="btn" onclick="login()">ç™»å…¥</button>
                </div>

                <div id="loginMessage"></div>
            </div>

            <!-- å„€è¡¨æ¿å€åŸŸ -->
            <div class="dashboard-section" id="dashboardSection">
                <div class="user-info" id="userInfo">
                    <!-- ç”¨æˆ¶è³‡è¨Šå°‡åœ¨é€™è£¡é¡¯ç¤º -->
                </div>

                <div class="services-grid">
                    <div class="service-card direct-submit" onclick="openLeaveApplication()">
                        <div class="icon">ğŸ–ï¸</div>
                        <h4>ç‰¹ä¼‘/è£œä¼‘ç”³è«‹<span class="badge">ç›´æ¥æäº¤</span></h4>
                        <p>ç›´æ¥åœ¨ç³»çµ±å…§æäº¤ç‰¹ä¼‘æˆ–è£œä¼‘ç”³è«‹ï¼Œç„¡éœ€è·³è½‰åˆ°å¤–éƒ¨è¡¨å–®ã€‚æ”¯æ´è‡ªå‹•æ™‚æ•¸è¨ˆç®—å’Œå³æ™‚ç‹€æ…‹æ›´æ–°ã€‚</p>
                        <p><strong>âœ¨ æ–°åŠŸèƒ½ï¼š</strong>åŒ…å«å€¼ç­ä»£ç†äººé¸æ“‡</p>
                    </div>

                    <div class="service-card" onclick="openExternalForm('è«‹å‡ç”³è«‹')">
                        <div class="icon">ğŸ¤’</div>
                        <h4>è«‹å‡ç”³è«‹</h4>
                        <p>ç”³è«‹ç—…å‡ã€äº‹å‡ç­‰å„é¡è«‹å‡ã€‚ç³»çµ±æœƒè‡ªå‹•è¨˜éŒ„ä¸¦é€šçŸ¥ç›¸é—œä¸»ç®¡é€²è¡Œå¯©æ ¸ã€‚</p>
                    </div>

                    <div class="service-card" onclick="openExternalForm('åŠ ç­ç”³è«‹')">
                        <div class="icon">â°</div>
                        <h4>åŠ ç­ç”³è«‹</h4>
                        <p>ç”³è«‹åŠ ç­ä¸¦è¨˜éŒ„åŠ ç­æ™‚æ•¸ã€‚æ”¯æ´ä¸åŒé¡å‹çš„åŠ ç­ç”³è«‹å’Œè‡ªå‹•è¨ˆç®—è£œå„Ÿã€‚</p>
                    </div>

                    <div class="service-card" onclick="openExternalForm('èª¿ç­ç”³è«‹')">
                        <div class="icon">ğŸ”„</div>
                        <h4>èª¿ç­ç”³è«‹</h4>
                        <p>ç”³è«‹èˆ‡åŒäº‹èª¿æ›ç­æ¬¡ã€‚ç³»çµ±æœƒè‡ªå‹•é€šçŸ¥ç›¸é—œäººå“¡ä¸¦è¨˜éŒ„èª¿ç­è³‡è¨Šã€‚</p>
                    </div>

                    <div class="service-card" onclick="openExternalForm('è£œæ‰“å¡ç”³è«‹')">
                        <div class="icon">â±ï¸</div>
                        <h4>è£œæ‰“å¡ç”³è«‹</h4>
                        <p>å¿˜è¨˜æ‰“å¡æ™‚å¯ä»¥ç”³è«‹è£œç™»è¨˜ã€‚éœ€è¦å¡«å¯«è©³ç´°çš„æ™‚é–“å’ŒåŸå› èªªæ˜ã€‚</p>
                    </div>

                    <div class="service-card" onclick="openExternalForm('æˆ¿å‹™çé‡‘ç”³è«‹')">
                        <div class="icon">ğŸ’°</div>
                        <h4>æˆ¿å‹™çé‡‘ç”³è«‹</h4>
                        <p>æˆ¿å‹™éƒ¨å“¡å·¥å°ˆç”¨çš„çé‡‘ç”³è«‹åŠŸèƒ½ã€‚æ ¹æ“šå·¥ä½œè¡¨ç¾å’Œå®¢æˆ¶æ»¿æ„åº¦ç”³è«‹çé‡‘ã€‚</p>
                    </div>
                </div>

                <button class="btn secondary" onclick="logout()" style="margin-top: 30px;">ç™»å‡º</button>
            </div>
        </div>
    </div>

    <!-- ç‰¹ä¼‘ç”³è«‹æ¨¡æ…‹æ¡† -->
    <div id="leaveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeLeaveModal()">&times;</span>
                <h3>ğŸ–ï¸ ç‰¹ä¼‘/è£œä¼‘ç”³è«‹ - å…¨å“¡æ¸¬è©¦ç‰ˆ</h3>
            </div>
            <div class="modal-body">
                <div class="alert info">
                    <strong>ğŸ“‹ å…¨å“¡æ¸¬è©¦æ¨¡å¼èªªæ˜ï¼š</strong><br>
                    â€¢ æ”¯æ´æ‰€æœ‰20ä½å“¡å·¥ç”³è«‹<br>
                    â€¢ ä½¿ç”¨çœŸå¯¦æ™‚æ•¸è³‡æ–™é€²è¡Œé©—è­‰<br>
                    â€¢ æ¸¬è©¦æ¨¡å¼ä¸‹æ™‚æ•¸ä¸æœƒå¯¦éš›æ‰£é™¤<br>
                    â€¢ æ‰€æœ‰é€šçŸ¥ç™¼é€çµ¦HRé€²è¡Œæ¸¬è©¦
                </div>

                <div class="form-group">
                    <label for="leaveType">ç”³è«‹é¡å‹ï¼š</label>
                    <select id="leaveType" onchange="updateLeaveValidation()">
                        <option value="annual">ç‰¹ä¼‘</option>
                        <option value="compensatory">è£œä¼‘</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="startDateTime">é–‹å§‹æ—¥æœŸæ™‚é–“ï¼š</label>
                    <input type="datetime-local" id="startDateTime" onchange="calculateHours()">
                </div>

                <div class="form-group">
                    <label for="endDateTime">çµæŸæ—¥æœŸæ™‚é–“ï¼š</label>
                    <input type="datetime-local" id="endDateTime" onchange="calculateHours()">
                </div>

                <div class="form-group">
                    <label>ç”³è«‹æ™‚æ•¸ï¼š</label>
                    <input type="number" id="calculatedHours" step="0.5" min="0.5" readonly style="background-color: #f8f9fa;">
                    <small style="color: #666; margin-top: 5px; display: block;">ç³»çµ±æœƒè‡ªå‹•è¨ˆç®—å·¥ä½œæ™‚é–“</small>
                </div>

                <!-- å€¼ç­ä»£ç†äººé¸æ“‡å€åŸŸ -->
                <div class="deputy-section">
                    <h4><span class="icon">ğŸ‘¤</span>å€¼ç­ä»£ç†äººé¸æ“‡</h4>
                    <p style="color: #666; margin-bottom: 15px;">è«‹é¸æ“‡æ‚¨è«‹å‡æœŸé–“çš„å€¼ç­ä»£ç†äººï¼š</p>
                    <div class="form-group">
                        <label for="dutyDeputy">å€¼ç­ä»£ç†äººï¼š</label>
                        <select id="dutyDeputy">
                            <option value="">è«‹é¸æ“‡ä»£ç†äºº...</option>
                            <option value="å»–è¿°ç››">å»–è¿°ç›› - è‘£äº‹é•·</option>
                            <option value="ç‹å½§ç–†">ç‹å½§ç–† - ç‡Ÿé‹ç¸½ç›£</option>
                            <option value="é™³å®¶èˆˆ">é™³å®¶èˆˆ - ç®¡ç†éƒ¨å‰¯ç†</option>
                            <option value="é»ƒå´‘å¢ƒ">é»ƒå´‘å¢ƒ - å·¥å‹™ä¸»ä»»</option>
                            <option value="å¾å¿—å±¹">å¾å¿—å±¹ - è¡ŒéŠ·æ¥­å‹™ä¸»ä»»</option>
                            <option value="æ±Ÿå­Ÿåº­">æ±Ÿå­Ÿåº­ - å®¢å‹™çµ„é•·</option>
                            <option value="è•­ç¶­å®">è•­ç¶­å® - å®¢å‹™çµ„é•·</option>
                            <option value="å®‹æ·å®‰">å®‹æ·å®‰ - é£¯åº—ç®¡å®¶</option>
                            <option value="é™³ç´…ç§€">é™³ç´…ç§€ - é£¯åº—ç®¡å®¶</option>
                            <option value="æ—å®¶æ¥™">æ—å®¶æ¥™ - é£¯åº—ç®¡å®¶</option>
                            <option value="æ¥Šä¸å‹›">æ¥Šä¸å‹› - é£¯åº—ç®¡å®¶</option>
                            <option value="å¾å¥•ç¿”">å¾å¥•ç¿” - é£¯åº—ç®¡å®¶</option>
                            <option value="æŸ¯å®—ç”·">æŸ¯å®—ç”· - å®¢å‹™çµ„é•·</option>
                            <option value="æç¶­è">æç¶­è - å®¢æˆ¿éƒ¨å‰¯ç†</option>
                            <option value="è¨±é‚¦èˆˆ">è¨±é‚¦èˆˆ - è³‡æ·±æˆ¿å‹™å“¡</option>
                            <option value="ç‹æ–‡ä¸€">ç‹æ–‡ä¸€ - è³‡æ·±æˆ¿å‹™çµ„é•·</option>
                            <option value="ç¾…ç´¹æ–‡">ç¾…ç´¹æ–‡ - è³‡æ·±æˆ¿å‹™å“¡</option>
                            <option value="æ—å¥‡ç·¯">æ—å¥‡ç·¯ - è³‡æ·±æˆ¿å‹™å“¡</option>
                            <option value="æŸ³ä½³ç’‹">æŸ³ä½³ç’‹ - è³‡æ·±æˆ¿å‹™å“¡</option>
                            <option value="HR">HR - äººäº‹</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="leaveReason">ç”³è«‹äº‹ç”±ï¼š</label>
                    <textarea id="leaveReason" rows="3" placeholder="è«‹ç°¡è¿°ç”³è«‹åŸå› ..." style="width: 100%; padding: 15px; border: 2px solid #e1e5e9; border-radius: 10px; font-family: inherit; resize: vertical;"></textarea>
                </div>

                <div id="leaveValidation" class="alert" style="display: none;"></div>

                <div class="loading" id="leaveLoading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨æäº¤ç”³è«‹...</p>
                </div>

                <button class="btn success" id="submitLeaveBtn" onclick="submitLeaveApplication()">æäº¤ç”³è«‹</button>
                <button class="btn secondary" onclick="closeLeaveModal()">å–æ¶ˆ</button>

                <div id="leaveResult"></div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbxtILe9n-3zlLUBncRAgrl2so2l45qPxeN3Ct4fGHucbrR8Tp1jN85v266YgvjOMkt8sg/exec';
        let currentUser = null;

        // å“¡å·¥ç·¨è™Ÿå°æ‡‰è¡¨
        const EMPLOYEE_IDS = {
            'å»–è¿°ç››': 'A19001',
            'ç‹å½§ç–†': 'A19051', 
            'é™³å®¶èˆˆ': 'A19104',
            'é»ƒå´‘å¢ƒ': 'A19132',
            'å¾å¿—å±¹': 'A19147',
            'æ±Ÿå­Ÿåº­': 'A19107',
            'è•­ç¶­å®': 'A19024',
            'å®‹æ·å®‰': 'A19114',
            'é™³ç´…ç§€': 'A19133',
            'æ—å®¶æ¥™': 'A19145',
            'æ¥Šä¸å‹›': 'A19149',
            'å¾å¥•ç¿”': 'A19152',
            'æŸ¯å®—ç”·': 'A19140',
            'æç¶­è': 'A19016',
            'è¨±é‚¦èˆˆ': 'A19065',
            'ç‹æ–‡ä¸€': 'A19146',
            'ç¾…ç´¹æ–‡': 'A19118',
            'æ—å¥‡ç·¯': 'A19136',
            'æŸ³ä½³ç’‹': 'A19151',
            'HR': 'A19002'
        };

        // åˆ‡æ›ç™»å…¥é¡å‹
        function toggleLoginType() {
            const loginType = document.getElementById('loginType').value;
            const firstLoginFields = document.getElementById('firstLoginFields');
            const normalLoginFields = document.getElementById('normalLoginFields');

            if (loginType === 'first') {
                firstLoginFields.style.display = 'block';
                normalLoginFields.style.display = 'none';
            } else {
                firstLoginFields.style.display = 'none';
                normalLoginFields.style.display = 'block';
            }
        }

        // é©—è­‰èº«ä»½
        async function verifyIdentity() {
            const name = document.getElementById('employeeName').value;
            const employeeId = document.getElementById('employeeId').value;

            if (!name || !employeeId) {
                showMessage('loginMessage', 'è«‹é¸æ“‡å§“åä¸¦è¼¸å…¥å“¡å·¥ç·¨è™Ÿ', 'error');
                return;
            }

            const expectedId = EMPLOYEE_IDS[name];
            if (employeeId !== expectedId) {
                showMessage('loginMessage', 'å“¡å·¥ç·¨è™Ÿèˆ‡å§“åä¸åŒ¹é…ï¼Œè«‹æª¢æŸ¥è¼¸å…¥', 'error');
                return;
            }

            showMessage('loginMessage', 'âœ… èº«ä»½é©—è­‰æˆåŠŸï¼è«‹è¨­å®šæ‚¨çš„å¯†ç¢¼', 'success');
            document.getElementById('passwordSetupFields').style.display = 'block';
        }

        // è¨­å®šå¯†ç¢¼
        async function setupPassword() {
            const name = document.getElementById('employeeName').value;
            const employeeId = document.getElementById('employeeId').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!newPassword || !confirmPassword) {
                showMessage('loginMessage', 'è«‹è¼¸å…¥å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showMessage('loginMessage', 'å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showMessage('loginMessage', 'å¯†ç¢¼è‡³å°‘éœ€è¦6å€‹å­—å…ƒ', 'error');
                return;
            }

            try {
                showMessage('loginMessage', 'æ­£åœ¨è¨­å®šå¯†ç¢¼...', 'info');

                const response = await fetch(WEBAPP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'setPassword',
                        employeeId: employeeId,
                        name: name,
                        password: newPassword
                    })
                });

                const responseText = await response.text();
                const data = JSON.parse(responseText);

                if (data.success) {
                    showMessage('loginMessage', 
                        `ğŸ‰ å¯†ç¢¼è¨­å®šæˆåŠŸï¼æ­¡è¿ ${data.data.employee.name}ï¼\n` +
                        `é€šçŸ¥å·²ç™¼é€çµ¦HRé€²è¡Œæ¸¬è©¦ç¢ºèªã€‚\n` +
                        `ç¾åœ¨æ‚¨å¯ä»¥ä½¿ç”¨æ–°å¯†ç¢¼ç™»å…¥ç³»çµ±ã€‚`, 'success');
                    
                    // æ¸…ç©ºå¯†ç¢¼æ¬„ä½
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    document.getElementById('passwordSetupFields').style.display = 'none';
                    
                    // åˆ‡æ›åˆ°æ­£å¸¸ç™»å…¥æ¨¡å¼
                    document.getElementById('loginType').value = 'normal';
                    toggleLoginType();
                } else {
                    showMessage('loginMessage', 'âŒ å¯†ç¢¼è¨­å®šå¤±æ•—ï¼š' + data.message, 'error');
                }
            } catch (error) {
                showMessage('loginMessage', 'âŒ å¯†ç¢¼è¨­å®šå¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        // ç™»å…¥
        async function login() {
            const name = document.getElementById('employeeName').value;
            const employeeId = document.getElementById('employeeId').value;
            const password = document.getElementById('password').value;

            if (!name || !employeeId || !password) {
                showMessage('loginMessage', 'è«‹å¡«å¯«æ‰€æœ‰å¿…è¦è³‡è¨Š', 'error');
                return;
            }

            const expectedId = EMPLOYEE_IDS[name];
            if (employeeId !== expectedId) {
                showMessage('loginMessage', 'å“¡å·¥ç·¨è™Ÿèˆ‡å§“åä¸åŒ¹é…', 'error');
                return;
            }

            try {
                showMessage('loginMessage', 'æ­£åœ¨ç™»å…¥...', 'info');

                const response = await fetch(WEBAPP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'verifyPassword',
                        employeeId: employeeId,
                        name: name,
                        password: password
                    })
                });

                const responseText = await response.text();
                const data = JSON.parse(responseText);

                if (data.success) {
                    currentUser = data.data.employee;
                    showDashboard();
                } else {
                    showMessage('loginMessage', 'âŒ ç™»å…¥å¤±æ•—ï¼š' + data.message, 'error');
                }
            } catch (error) {
                showMessage('loginMessage', 'âŒ ç™»å…¥å¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        // é¡¯ç¤ºå„€è¡¨æ¿
        function showDashboard() {
            document.getElementById('loginSection').classList.remove('active');
            document.getElementById('dashboardSection').classList.add('active');

            const userInfo = document.getElementById('userInfo');
            userInfo.innerHTML = `
                <h3>ğŸ‘‹ æ­¡è¿ï¼Œ${currentUser.name}ï¼</h3>
                <p><strong>éƒ¨é–€ï¼š</strong>${currentUser.department}</p>
                <p><strong>è·ä½ï¼š</strong>${currentUser.position}</p>
                <p><strong>æ¬Šé™ç­‰ç´šï¼š</strong>${currentUser.authority}</p>
                <p><strong>Emailï¼š</strong>${currentUser.email}</p>
                <div class="hours">
                    <span>ğŸ–ï¸ ç‰¹ä¼‘ï¼š${currentUser.annualLeave} å°æ™‚</span>
                    <span>â° è£œä¼‘ï¼š${currentUser.compensatoryLeave} å°æ™‚</span>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <small><strong>ğŸ§ª æ¸¬è©¦æ¨¡å¼ï¼š</strong>æ‰€æœ‰ç”³è«‹å’Œé€šçŸ¥æœƒç™¼é€çµ¦HRé€²è¡Œæ¸¬è©¦ï¼Œä¸æœƒå½±éŸ¿å¯¦éš›æ¥­å‹™æµç¨‹ã€‚</small>
                </div>
            `;
        }

        // é–‹å•Ÿç‰¹ä¼‘ç”³è«‹
        function openLeaveApplication() {
            document.getElementById('leaveModal').style.display = 'block';
            updateLeaveValidation();
        }

        // é—œé–‰ç‰¹ä¼‘ç”³è«‹æ¨¡æ…‹æ¡†
        function closeLeaveModal() {
            document.getElementById('leaveModal').style.display = 'none';
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('startDateTime').value = '';
            document.getElementById('endDateTime').value = '';
            document.getElementById('calculatedHours').value = '';
            document.getElementById('dutyDeputy').value = '';
            document.getElementById('leaveReason').value = '';
            document.getElementById('leaveResult').innerHTML = '';
            document.getElementById('leaveValidation').style.display = 'none';
        }

        // è¨ˆç®—æ™‚æ•¸
        function calculateHours() {
            const startDateTime = document.getElementById('startDateTime').value;
            const endDateTime = document.getElementById('endDateTime').value;

            if (startDateTime && endDateTime) {
                const start = new Date(startDateTime);
                const end = new Date(endDateTime);

                if (end <= start) {
                    document.getElementById('calculatedHours').value = '';
                    updateLeaveValidation();
                    return;
                }

                // è¨ˆç®—ç¸½å°æ™‚æ•¸ï¼ˆç°¡åŒ–è¨ˆç®—ï¼Œå¯¦éš›å¯èƒ½éœ€è¦è€ƒæ…®å·¥ä½œæ™‚é–“ï¼‰
                const diffMs = end - start;
                const diffHours = diffMs / (1000 * 60 * 60);
                
                // å››æ¨äº”å…¥åˆ°0.5å°æ™‚
                const roundedHours = Math.round(diffHours * 2) / 2;
                document.getElementById('calculatedHours').value = roundedHours;
            }

            updateLeaveValidation();
        }

        // æ›´æ–°ç”³è«‹é©—è­‰
        function updateLeaveValidation() {
            const leaveType = document.getElementById('leaveType').value;
            const calculatedHours = parseFloat(document.getElementById('calculatedHours').value) || 0;
            const dutyDeputy = document.getElementById('dutyDeputy').value;
            const validation = document.getElementById('leaveValidation');
            const submitBtn = document.getElementById('submitLeaveBtn');

            let messages = [];
            let canSubmit = true;

            // æª¢æŸ¥æ™‚æ•¸
            if (calculatedHours <= 0) {
                messages.push('âŒ è«‹è¨­å®šæ­£ç¢ºçš„é–‹å§‹å’ŒçµæŸæ™‚é–“');
                canSubmit = false;
            } else {
                const availableHours = leaveType === 'annual' ? currentUser.annualLeave : currentUser.compensatoryLeave;
                if (calculatedHours > availableHours) {
                    messages.push(`âŒ ç”³è«‹æ™‚æ•¸ ${calculatedHours} å°æ™‚è¶…éå¯ç”¨æ™‚æ•¸ ${availableHours} å°æ™‚`);
                    canSubmit = false;
                } else {
                    messages.push(`âœ… ç”³è«‹ ${calculatedHours} å°æ™‚ï¼Œå‰©é¤˜ ${availableHours - calculatedHours} å°æ™‚`);
                }
            }

            // æª¢æŸ¥ä»£ç†äºº
            if (!dutyDeputy) {
                messages.push('âŒ è«‹é¸æ“‡å€¼ç­ä»£ç†äºº');
                canSubmit = false;
            } else {
                messages.push(`âœ… å€¼ç­ä»£ç†äººï¼š${dutyDeputy}`);
            }

            if (messages.length > 0) {
                validation.innerHTML = messages.join('<br>');
                validation.className = 'alert ' + (canSubmit ? 'success' : 'error');
                validation.style.display = 'block';
            } else {
                validation.style.display = 'none';
            }

            submitBtn.disabled = !canSubmit;
            submitBtn.style.opacity = canSubmit ? '1' : '0.5';
        }

        // æäº¤ç”³è«‹
        async function submitLeaveApplication() {
            const leaveType = document.getElementById('leaveType').value;
            const startDateTime = document.getElementById('startDateTime').value;
            const endDateTime = document.getElementById('endDateTime').value;
            const calculatedHours = parseFloat(document.getElementById('calculatedHours').value);
            const dutyDeputy = document.getElementById('dutyDeputy').value;
            const leaveReason = document.getElementById('leaveReason').value;

            if (!startDateTime || !endDateTime || !calculatedHours || !dutyDeputy) {
                showMessage('leaveResult', 'è«‹å¡«å¯«æ‰€æœ‰å¿…è¦è³‡è¨Š', 'error');
                return;
            }

                try {
                document.getElementById('leaveLoading').classList.add('show');
                document.getElementById('submitLeaveBtn').disabled = true;

                // æª¢æŸ¥åƒæ•¸
                console.log('å‰ç«¯åƒæ•¸æª¢æŸ¥:');
                console.log('- currentUser:', currentUser);
                console.log('- employeeId:', currentUser.employeeId);
                console.log('- leaveType:', leaveType);
                console.log('- calculatedHours:', calculatedHours);

                const response = await fetch(WEBAPP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'submitLeaveApplication',
                        employeeId: currentUser.employeeId,
                        leaveType: leaveType,
                        startDateTime: startDateTime,
                        endDateTime: endDateTime,
                        leaveHours: calculatedHours,
                        dutyDeputy: dutyDeputy,
                        leaveReason: leaveReason
                    })
                });

                const responseText = await response.text();
                const data = JSON.parse(responseText);

                if (data.success) {
                    const resultMessage = `
                        ğŸ‰ ç”³è«‹æäº¤æˆåŠŸï¼<br><br>
                        <strong>ç”³è«‹ç·¨è™Ÿï¼š</strong>${data.data.applicationId}<br>
                        <strong>ç”³è«‹é¡å‹ï¼š</strong>${leaveType === 'annual' ? 'ç‰¹ä¼‘' : 'è£œä¼‘'}<br>
                        <strong>ç”³è«‹æ™‚æ•¸ï¼š</strong>${calculatedHours} å°æ™‚<br>
                        <strong>å€¼ç­ä»£ç†äººï¼š</strong>${dutyDeputy}<br>
                        <strong>é€šçŸ¥ç‹€æ…‹ï¼š</strong>${data.data.emailSent ? 'å·²ç™¼é€çµ¦HRï¼ˆæ¸¬è©¦æ¨¡å¼ï¼‰' : 'ç™¼é€å¤±æ•—'}<br><br>
                        <strong>ğŸ§ª æ¸¬è©¦æ¨¡å¼èªªæ˜ï¼š</strong><br>
                        â€¢ æ™‚æ•¸å·²å¯¦éš›æ‰£é™¤ï¼ˆ${data.data.leaveUpdate.note}ï¼‰<br>
                        â€¢ é€šçŸ¥å·²ç™¼é€çµ¦HRé€²è¡Œæ¸¬è©¦<br>
                        â€¢ ç”³è«‹è³‡æ–™å·²å®Œæ•´è¨˜éŒ„
                    `;
                    showMessage('leaveResult', resultMessage, 'success');
                    
                    // æ›´æ–°ç”¨æˆ¶æ™‚æ•¸é¡¯ç¤ºï¼ˆæ¨¡æ“¬ï¼‰
                    if (data.data.leaveUpdate) {
                        const hoursSpan = document.querySelector(leaveType === 'annual' ? '.hours span:first-child' : '.hours span:last-child');
                        if (hoursSpan) {
                            hoursSpan.innerHTML = `${leaveType === 'annual' ? 'ğŸ–ï¸ ç‰¹ä¼‘' : 'â° è£œä¼‘'}ï¼š${data.data.leaveUpdate.newHours} å°æ™‚`;
                        }
                    }
                } else {
                    showMessage('leaveResult', 'âŒ ç”³è«‹æäº¤å¤±æ•—ï¼š' + data.message, 'error');
                }
            } catch (error) {
                showMessage('leaveResult', 'âŒ ç”³è«‹æäº¤å¤±æ•—ï¼š' + error.message, 'error');
            } finally {
                document.getElementById('leaveLoading').classList.remove('show');
                document.getElementById('submitLeaveBtn').disabled = false;
            }
        }

        // é–‹å•Ÿå¤–éƒ¨è¡¨å–®
        function openExternalForm(formType) {
            alert(`${formType}åŠŸèƒ½å°‡åœ¨å¾ŒçºŒç‰ˆæœ¬ä¸­é–‹æ”¾ã€‚\nç›®å‰å°ˆæ³¨æ–¼ç‰¹ä¼‘/è£œä¼‘ç”³è«‹çš„å®Œæ•´æ¸¬è©¦ã€‚`);
        }

        // ç™»å‡º
        function logout() {
            currentUser = null;
            document.getElementById('dashboardSection').classList.remove('active');
            document.getElementById('loginSection').classList.add('active');
            
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('employeeName').value = '';
            document.getElementById('employeeId').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginMessage').innerHTML = '';
            
            // é‡ç½®ç™»å…¥é¡å‹
            document.getElementById('loginType').value = 'first';
            toggleLoginType();
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="alert ${type}">${message}</div>`;
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // æª¢æŸ¥æ˜¯å¦è¨­å®šäº†Web App URL
            if (WEBAPP_URL === 'YOUR_WEBAPP_URL_HERE') {
                showMessage('loginMessage', 
                    'âš ï¸ è«‹å…ˆè¨­å®šWeb App URL\n' +
                    'è«‹å°‡ç¨‹å¼ç¢¼ä¸­çš„ YOUR_WEBAPP_URL_HERE æ›¿æ›ç‚ºå¯¦éš›çš„Google Apps Script Web App URL', 
                    'error');
            }
            
            // è¨­å®šé è¨­ç™»å…¥é¡å‹
            toggleLoginType();
            
            // ç‚ºä»£ç†äººé¸æ“‡æ·»åŠ äº‹ä»¶ç›£è½
            document.getElementById('dutyDeputy').addEventListener('change', updateLeaveValidation);
        });

        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        window.onclick = function(event) {
            const modal = document.getElementById('leaveModal');
            if (event.target === modal) {
                closeLeaveModal();
            }
        }
    </script>
</body>
</html>
